services:
  # Service de surveillance et de build automatique
  builder:
    image: mcr.microsoft.com/playwright:v1.57.0-jammy
    working_dir: /app
    user: "${UID:-1000}:${GID:-1000}"
    volumes:
      - .:/app
      - /app/node_modules
    # Installe les dépendances puis lance nodemon pour surveiller les changements
    command: >
      sh -c "npm install && npx nodemon -L --watch build.js --watch data.json --watch src --watch client.js --exec 'node build.js'"
    environment:
      - CI=true
      - HOME=/app

  # Service web pour visualiser le résultat
  preview:
    image: nginx:alpine
    ports:
      - "8080:80"
    volumes:
      - .:/usr/share/nginx/html
    depends_on:
      - builder
